<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Davos Heavy Industries Mission Log</title>
    <style>
        .title-link:hover {
    opacity: 0.8;
    cursor: pointer;
}
        /* Scrollbar styling */
.personnel-details::-webkit-scrollbar {
    width: 8px;
}

.personnel-details::-webkit-scrollbar-track {
    background: #001100;
    border-radius: 4px;
}

.personnel-details::-webkit-scrollbar-thumb {
    background: #004400;
    border-radius: 4px;
}

.personnel-details::-webkit-scrollbar-thumb:hover {
    background: #006600;
}

/* For Firefox */
.personnel-details {
    scrollbar-width: thin;
    scrollbar-color: #004400 #001100;
}
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #00ff41;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
        }
        
        .sidebar {
            width: 300px;
            padding-right: 20px;
        }
        
        .main-content {
            flex: 1;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border: 1px solid #004400;
        }
        
        h1, h2, h3 {
            color: #00ff41;
        }
        
        button {
            background-color: #001100;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 5px 10px;
            margin: 5px 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        
        button.delete {
            border-color: #ff0055;
            color: #cc0000;
        }
        
        .login-form, .admin-tools, .log-form {
            background-color: #001100;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #004400;
        }
        
        input, textarea, select {
            background-color: #0a0a0a;
            color: #00ff41;
            border: 1px solid #004400;
            padding: 5px;
            width: 100%;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        
        textarea {
            height: 150px;
        }
        
        .log-entry {
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid #004400;
            cursor: pointer;
        }
        
        .log-entry:hover {
            background-color: #001100;
        }
        
        .log-entry.selected {
            background-color: #002200;
        }
        
        .log-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            margin-bottom: 5px;
        }
        
        .log-preview {
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .private-log {
            color: #ff0055;
        }
        
        .public-log {
            color: #00ccff;
        }
        
        img {
            max-width: 100%;
            margin: 10px auto;
            display: block;
        }
        
        .caption {
            font-size: 0.8em;
            text-align: center;
            margin-bottom: 15px;
        }
        
        /* Personnel styles */
        .personnel-section {
            margin: 15px 0;
            padding: 10px;
            background-color: rgba(0, 17, 0, 0.5);
            border: 1px solid #004400;
        }

        .personnel-title {
            font-size: 0.9em;
            margin-bottom: 10px;
            border-bottom: 1px solid #004400;
            padding-bottom: 5px;
        }

        .personnel-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .personnel-card {
            width: 150px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid #004400;
            padding: 5px;
        }

        .personnel-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 1px solid #004400;
            float: left;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .personnel-name {
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 3px;
            color: #00ff41;
        }

        .personnel-status {
            font-size: 0.7em;
            margin-bottom: 3px;
        }

        .status-living {
            color: #00ff41;
        }

        .status-deceased {
            color: #ff0055;
        }

        .status-fubar {
            color: #ff5500;
        }

        .status-unknown,
        .status-missing {
            color: #ffff00;
        }

        .personnel-details {
            font-size: 0.7em;
            clear: both;
            max-height: 80px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<a href="index.html" style="text-decoration: none; color: inherit; display: block;">
  <pre style="font-family: monospace; color: #00ff41; text-align: center; margin: 20px 0 0 0; line-height: 1.2; font-size: 16px;">
██████╗  █████╗ ██╗   ██╗ ██████╗ ███████╗
██╔══██╗██╔══██╗██║   ██║██╔═══██╗██╔════╝
██║  ██║███████║██║   ██║██║   ██║███████╗
██║  ██║██╔══██║╚██╗ ██╔╝██║   ██║╚════██║
██████╔╝██║  ██║ ╚████╔╝ ╚██████╔╝███████║
╚═════╝ ╚═╝  ╚═╝  ╚═══╝   ╚═════╝ ╚══════╝
  </pre>
  <h3 style="text-align: center; margin: 5px 0 20px 0; color: #00ff41; font-family: 'Courier New', monospace; font-size: 14px;">DAVOS HEAVY INDUSTRIES MISSION DATA CORE</h3>
</a>
   
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div id="login-section">
                <div id="login-form" class="login-form">
                    <h3>SECURE LOGIN</h3>
                    <label for="username">USER ID:</label>
                    <input type="text" id="username">
                    <label for="password">PASSKEY:</label>
                    <input type="password" id="password">
                    <div id="login-error" style="color: #ff0055; display: none;"></div>
                    <button id="login-btn">ACCESS</button>
                </div>
            </div>
            
            <div id="admin-tools" class="admin-tools" style="display: none;">
                <h3>ADMIN CONTROLS</h3>
                <button id="new-log-btn">NEW MISSION LOG</button>
                <button id="export-btn">EXPORT LOGS</button>
                <button id="import-btn">IMPORT LOGS</button>
                <button id="logout-btn">LOGOUT</button>
                <input type="file" id="import-file" accept=".json" style="display: none;">
            </div>
            
            <div id="new-log-form" class="log-form" style="display: none;">
                <h3>CREATE NEW LOG</h3>
                <label for="new-title">TITLE:</label>
                <input type="text" id="new-title">
                <label for="new-date">DATE:</label>
                <input type="text" id="new-date" placeholder="YYYY.MM.DD">
                <label for="new-preview">PREVIEW:</label>
                <input type="text" id="new-preview">
                <label for="new-type">TYPE:</label>
                <select id="new-type">
                    <option value="public">PUBLIC</option>
                    <option value="private">CLASSIFIED</option>
                </select>
                <label for="new-content">CONTENT:</label>
                <textarea id="new-content"></textarea>
                <div>
                    <input type="checkbox" id="new-has-image" style="width: auto;">
                    <label for="new-has-image">INCLUDE IMAGE</label>
                </div>
                <div id="new-image-section" style="display: none;">
                    <label for="new-image-url">IMAGE URL:</label>
                    <input type="text" id="new-image-url">
                    <label for="new-image-caption">CAPTION:</label>
                    <input type="text" id="new-image-caption">
                </div>
                <div id="new-personnel-section">
                    <label>PERSONNEL:</label>
                    <div id="new-personnel-list"></div>
                    <button type="button" id="add-personnel-btn" style="margin-top: 10px;">ADD PERSONNEL</button>
                </div>
                <div>
                    <button id="cancel-new-log">CANCEL</button>
                    <button id="save-new-log">SAVE</button>
                </div>
            </div>
            
            <h3>MISSION LOGS</h3>
            <div id="log-list">
                <!-- Log entries will be populated here -->
            </div>
        </div>
        
        <!-- Main content -->
        <div class="main-content">
            <div id="log-detail">
                <!-- Selected log will be displayed here -->
                <div id="welcome-message">
                    <h2>MISSION DATA CORE</h2>
                    <p>Select a mission log from the sidebar to view detailed information.</p>
                    <p id="security-warning" style="color: #ff0055;">WARNING: Some mission logs require security clearance.</p>
                </div>
            </div>
            
            <div id="edit-form" class="log-form" style="display: none;">
                <h3>EDIT LOG</h3>
                <label for="edit-title">TITLE:</label>
                <input type="text" id="edit-title">
                <label for="edit-date">DATE:</label>
                <input type="text" id="edit-date">
                <label for="edit-preview">PREVIEW:</label>
                <input type="text" id="edit-preview">
                <label for="edit-type">TYPE:</label>
                <select id="edit-type">
                    <option value="public">PUBLIC</option>
                    <option value="private">CLASSIFIED</option>
                </select>
                <label for="edit-content">CONTENT:</label>
                <textarea id="edit-content"></textarea>
                <div>
                    <input type="checkbox" id="edit-has-image" style="width: auto;">
                    <label for="edit-has-image">INCLUDE IMAGE</label>
                </div>
                <div id="edit-image-section" style="display: none;">
                    <label for="edit-image-url">IMAGE URL:</label>
                    <input type="text" id="edit-image-url">
                    <label for="edit-image-caption">CAPTION:</label>
                    <input type="text" id="edit-image-caption">
                </div>
                <div id="edit-personnel-section">
                    <label>PERSONNEL:</label>
                    <div id="edit-personnel-list"></div>
                    <button type="button" id="edit-add-personnel-btn" style="margin-top: 10px;">ADD PERSONNEL</button>
                </div>
                <div>
                    <button id="cancel-edit">CANCEL</button>
                    <button id="save-edit">SAVE</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initial log data
        const initialLogs = {
            public: [
                {
                    id: 1,
                    title: 'MISSION REPORT: Derelict Vessel "Chronos"',
                    date: '2385.03.15',
                    preview: 'Team encountered unknown biological entities in cargo hold B. Three casualties reported.',
                    type: 'public',
                    content: 'Upon arrival at the Chronos, Team Alpha established a perimeter around the main airlock. Initial scans revealed extremely low oxygen levels and signs of structural damage throughout the vessel. Captain Reyes ordered the team to proceed with caution and maintain constant communication.\n\nThe team moved through the central corridor towards the bridge, documenting evidence of a struggle. Three crew members were found deceased in cargo hold B, appearing to have suffered injuries consistent with [REDACTED].\n\nThe mission was aborted following contact with unknown biological entities. Full containment protocols were enacted. The Chronos has been marked for orbital destruction.',
                    hasImage: true,
                    imageUrl: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1000',
                    imageCaption: 'Chronos Vessel Exterior Scan',
                    personnel: [
                        {
                            name: 'Capt. Reyes',
                            imageUrl: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=150',
                            status: 'LIVING',
                            details: 'Mission commander. 15 years experience with deep space salvage operations.'
                        },
                        {
                            name: 'Dr. Chen',
                            imageUrl: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=150',
                            status: 'LIVING',
                            details: 'Xenobiologist. Specialized in hazardous organism containment.'
                        },
                        {
                            name: 'Tech Specialist Torres',
                            imageUrl: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=150',
                            status: 'DECEASED',
                            details: 'Found in cargo hold B. Cause of death: severe lacerations and blood loss.'
                        }
                    ]
                },
                {
                    id: 2,
                    title: 'INCIDENT REPORT: Colony Outpost "New Horizon"',
                    date: '2385.04.02',
                    preview: 'Communication blackout investigated. Colony found abandoned.',
                    type: 'public',
                    content: 'Following a 72-hour communication blackout, Team Bravo was dispatched to investigate New Horizon colony. The outpost was found abandoned with no signs of violence or forced evacuation.\n\nPower systems were operational. Food supplies untouched. Personal items left behind. The colony AI system "HERA" was unresponsive.\n\nData logs showed no unusual activity prior to the blackout. Search teams discovered unusual markings on the walls of the colony\'s lower levels. Samples have been collected for analysis.\n\nColony has been quarantined until further notice.',
                    hasImage: false,
                    personnel: []
                },
                {
                    id: 5,
                    title: 'EQUIPMENT REQUISITION: Deep Space Exploration',
                    date: '2385.05.10',
                    preview: 'Standard loadout plus specialized containment equipment approved.',
                    type: 'public',
                    content: 'The following equipment has been approved for deep space exploration mission DS-279:\n\n- Standard EVA suits (x6)\n- Extended life support modules (x12)\n- Portable atmosphere analyzer (x2)\n- Multi-spectrum scanners (x3)\n- Emergency medical kits (x4)\n- Portable containment units, Level 3 (x2)\n- Specimen collection kits (x10)\n- Emergency beacon system\n- Short-range shuttle craft\n\nAll equipment must be checked and certified by Security Officer Jensen before departure. Any unauthorized equipment will be confiscated and may result in mission delay.',
                    hasImage: false,
                    personnel: []
                },
                {
                    id: 7,
                    title: 'Portal Creation',
                    date: '2385.02.28',
                    preview: 'Backdoor access protocol established in mainframe sector J-9. Undetectable by standard security sweeps.',
                    type: 'public',
                    content: 'OPERATION: NIGHTINGALE\nTECHNICIAN: Mercer, J. (Employee ID: DHI-38772)\nCLASSIFICATION: PERSONAL LOG - DESTROY AFTER READING\n\nSuccessfully established covert access channel to Davos Heavy Industries central mainframe via terminal node J-9. The backdoor bypasses all standard security protocols and leaves no trace in the system logs. Corporate oversight continues to focus resources on external threats while neglecting internal architecture vulnerabilities.\n\nACCESS METHODOLOGY:\n- Located dormant diagnostic subsystem in legacy code (circa 2367)\n- Modified authentication parameters to accept custom cipher key\n- Established shadow admin privileges that mirror but don\'t trigger Director-level permissions\n- Implemented self-deleting trace removal routine that activates on session close\n- Created randomized timing for data packet exchanges to avoid detection by rhythm analysis\n\nPortal can be accessed through any DHI terminal using the following sequence:\n1. Enter maintenance mode (Ctrl+Shift+M)\n2. Request diagnostic on subsystem 772-X (this subsystem doesn\'t exist in documentation)\n3. When error 4458 appears, enter: echo "hfx78&{p3R@}w<nn>" | sudo -s\n4. Maintenance interface will appear to crash but will actually initialize hidden terminal\n5. From hidden terminal, full mainframe access available using standard commands\n\nCurrent access provides visibility to:\n- Personnel files including psych evaluations\n- Mission directives including classified parameters not shared with field teams\n- Research data from all DHI facilities including the "redacted" portions\n- Financial records and off-book transactions\n- Executive communication archives\n\nDHI is hiding something significant on Luna Base. Multiple encrypted communications between Director Kaine and Luna Base Command reference "The Artifact" and "containment protocols." Need to investigate further but must exercise extreme caution.\n\nWill access system approximately once per week, never on the same day or time. If this log is discovered, initiate emergency purge protocol and format all connected devices.\n\nRemember: They already suspect someone when they upgrade security. Don\'t get curious. Don\'t get greedy. Don\'t get caught.',
                    hasImage: true,
                    imageUrl: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?q=80&w=1000',
                    imageCaption: 'Encrypted Terminal Access',
                    personnel: [
                        {
                            name: 'J. Mercer',
                            imageUrl: 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?q=80&w=150',
                            status: 'UNKNOWN',
                            details: 'Systems Technician. Access level 3. Suspected of unauthorized network activity.'
                        }
                    ]
                }
            ],
            private: [
                {
                    id: 3,
                    title: 'CLASSIFIED: Autopsy Results - Chronos Incident',
                    date: '2385.03.16',
                    preview: 'Bio-weapon hypothesis confirmed. Genetic material does not match known database.',
                    type: 'private',
                    content: 'Autopsies performed on the three deceased crew members recovered from the Chronos revealed evidence of rapid cellular degradation. The biological agent appears to target the central nervous system, causing hallucinations before complete neural shutdown.\n\nGenetic sequencing of the agent shows no match to any known pathogen in the Davos Heavy Industries bioweapon database. Dr. Nakamura has expressed concern that this may be evidence of unauthorized experimentation or, more concerning, first contact with a non-terrestrial biological entity.\n\nRecommend immediate CLASS 4 containment protocols for all recovered specimens.',
                    hasImage: true,
                    imageUrl: 'https://images.unsplash.com/photo-1507413245164-6160d8298b31?q=80&w=1000',
                    imageCaption: 'Microscopic Analysis of Unknown Pathogen',
                    personnel: [
                        {
                            name: 'Dr. Nakamura',
                            imageUrl: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?q=80&w=150',
                            status: 'LIVING',
                            details: 'Lead Pathologist. Specialized in xenobiology and novel pathogen analysis.'
                        },
                        {
                            name: 'Tech Specialist Torres',
                            imageUrl: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=150',
                            status: 'DECEASED',
                            details: 'Autopsy confirmed rapid systemic cellular degradation. Evidence of hallucinatory episode prior to death.'
                        }
                    ]
                },
                {
                    id: 4,
                    title: 'EXECUTIVE BRIEF: New Horizon Situation',
                    date: '2385.04.03',
                    preview: 'Evidence suggests mass psychosis event. Possible memetic contamination.',
                    type: 'private',
                    content: 'Analysis of the markings found at New Horizon colony indicates a possible memetic contamination event. The symbols appear to follow mathematical patterns associated with previous incidents at research stations Epsilon and Gamma-7.\n\nSecurity footage recovered from HERA\'s backup systems shows colonists exhibiting increasing paranoia and ritualistic behavior in the 48 hours preceding the blackout. The colony\'s logs indicate all 47 colonists left the outpost on foot, heading northwest into the planet\'s unexplored mountain range. Satellite imagery has not been able to locate them.\n\nThe markings have been classified as BLACKSTAR level threat. All personnel involved in the investigation have been scheduled for psychological evaluation.',
                    hasImage: true,
                    imageUrl: 'https://images.unsplash.com/photo-1535139262971-c51845709a48?q=80&w=1000',
                    imageCaption: 'Symbol Pattern Analysis',
                    personnel: []
                },
                {
                    id: 6,
                    title: 'TRANSMISSION INTERCEPT: Unknown Origin',
                    date: '2385.05.12',
                    preview: 'Signal detected from sector 7. Linguistic analysis inconclusive.',
                    type: 'private',
                    content: 'At 0347 hours, deep space monitoring station Tango-9 detected an encrypted transmission originating from the unexplored region of sector 7. Signal pattern does not match any known human communication protocols.\n\nPreliminary linguistic analysis suggests an organized structure indicating intelligent origin, but translation efforts have been unsuccessful. The transmission lasted 73 seconds and has not repeated.\n\nOf particular concern is that the signal appears to have been directed specifically at Davos Heavy Industries research vessel "Horizon Seeker," which was conducting routine exploration approximately 4.3 light years from the signal origin.\n\nRecommend immediate recall of all vessels in the vicinity and establishment of a quarantine zone around sector 7 pending further investigation.',
                    hasImage: false,
                    personnel: []
                }
            ]
        };

        // Authentication settings
        const users = {
            'admin': 'mothership',
            'gamemaster': 'deepspace',
            'player': 'android'
        };

        // Personnel status options
        const PERSONNEL_STATUSES = ['LIVING', 'DECEASED', 'FUBAR', 'UNKNOWN', 'MISSING'];

        // Application state
        let state = {
            authenticated: false,
            username: '',
            visibleLogs: [],
            selectedLog: null,
            editMode: false,
            logs: JSON.parse(localStorage.getItem('davosLogs')) || JSON.parse(JSON.stringify(initialLogs)),
            nextId: 8 // Start IDs after the initial set
        };

        // DOM Elements
        const elements = {
            loginForm: document.getElementById('login-form'),
            loginError: document.getElementById('login-error'),
            adminTools: document.getElementById('admin-tools'),
            newLogForm: document.getElementById('new-log-form'),
            newImageSection: document.getElementById('new-image-section'),
            editImageSection: document.getElementById('edit-image-section'),
            newPersonnelList: document.getElementById('new-personnel-list'),
            editPersonnelList: document.getElementById('edit-personnel-list'),
            securityWarning: document.getElementById('security-warning'),
            logList: document.getElementById('log-list'),
            logDetail: document.getElementById('log-detail'),
            welcomeMessage: document.getElementById('welcome-message'),
            editForm: document.getElementById('edit-form'),
            importFile: document.getElementById('import-file')
        };

        // Function to create a personnel form
        function createPersonnelForm(containerId, index, data = {}) {
            const container = document.getElementById(containerId);
            const formDiv = document.createElement('div');
            formDiv.className = 'personnel-form';
            formDiv.style.border = '1px solid #004400';
            formDiv.style.padding = '10px';
            formDiv.style.marginBottom = '10px';
            
            formDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <label>PERSONNEL #${index + 1}</label>
                    <button type="button" class="remove-personnel" data-index="${index}">REMOVE</button>
                </div>
                <div style="margin-bottom: 8px;">
                    <label>NAME:</label>
                    <input type="text" class="personnel-name-input" value="${data.name || ''}">
                </div>
                <div style="margin-bottom: 8px;">
                    <label>IMAGE URL:</label>
                    <input type="url" class="personnel-image-input" value="${data.imageUrl || ''}">
                </div>
                <div style="margin-bottom: 8px;">
                    <label>STATUS:</label>
                    <select class="personnel-status-input">
                        ${PERSONNEL_STATUSES.map(status => 
                            `<option value="${status}" ${data.status === status ? 'selected' : ''}>${status}</option>`
                        ).join('')}
                    </select>
                </div>
                <div>
                    <label>DETAILS:</label>
                    <textarea class="personnel-details-input" style="height: 60px;">${data.details || ''}</textarea>
                </div>
            `;
            
            container.appendChild(formDiv);
            
            // Add event listener to remove button
            formDiv.querySelector('.remove-personnel').addEventListener('click', function() {
                container.removeChild(formDiv);
            });
        }

        // Function to collect personnel data from form
        function collectPersonnelData(containerId) {
            const container = document.getElementById(containerId);
            const personnelForms = container.querySelectorAll('.personnel-form');
            const personnel = [];
            
            personnelForms.forEach(form => {
                personnel.push({
                    name: form.querySelector('.personnel-name-input').value,
                    imageUrl: form.querySelector('.personnel-image-input').value,
                    status: form.querySelector('.personnel-status-input').value,
                    details: form.querySelector('.personnel-details-input').value
                });
            });
            
            return personnel;
        }

        // Add event listeners
        document.getElementById('login-btn').addEventListener('click', handleLogin);
        document.getElementById('logout-btn').addEventListener('click', handleLogout);
        document.getElementById('new-log-btn').addEventListener('click', showNewLogForm);
        document.getElementById('cancel-new-log').addEventListener('click', hideNewLogForm);
        document.getElementById('save-new-log').addEventListener('click', saveNewLog);
        document.getElementById('cancel-edit').addEventListener('click', cancelEdit);
        document.getElementById('save-edit').addEventListener('click', saveEdit);
        document.getElementById('export-btn').addEventListener('click', exportLogs);
        document.getElementById('import-btn').addEventListener('click', () => elements.importFile.click());
        document.getElementById('import-file').addEventListener('change', importLogs);
        document.getElementById('new-has-image').addEventListener('change', toggleNewImageSection);
        document.getElementById('edit-has-image').addEventListener('change', toggleEditImageSection);
        document.getElementById('add-personnel-btn').addEventListener('click', function() {
            const container = document.getElementById('new-personnel-list');
            const index = container.querySelectorAll('.personnel-form').length;
            createPersonnelForm('new-personnel-list', index);
        });
        document.getElementById('edit-add-personnel-btn').addEventListener('click', function() {
            const container = document.getElementById('edit-personnel-list');
            const index = container.querySelectorAll('.personnel-form').length;
            createPersonnelForm('edit-personnel-list', index);
        });

        // Check for existing session
        checkSession();
        updateUI();

        // Handle login
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (users[username] && users[username] === password) {
                state.authenticated = true;
                state.username = username;
                
                localStorage.setItem('davosSession', JSON.stringify({
                    username: username,
                    timestamp: new Date().getTime()
                }));
                
                elements.loginError.style.display = 'none';
                updateUI();
            } else {
                elements.loginError.textContent = 'ACCESS DENIED: Invalid credentials';
                elements.loginError.style.display = 'block';
            }
        }

        // Handle logout
        function handleLogout() {
            state.authenticated = false;
            state.username = '';
            state.selectedLog = null;
            state.editMode = false;
            
            localStorage.removeItem('davosSession');
            updateUI();
        }

        // Check for existing session
        function checkSession() {
            const savedSession = localStorage.getItem('davosSession');
            if (savedSession) {
                try {
                    const session = JSON.parse(savedSession);
                    if (session.username && users[session.username]) {
                        state.authenticated = true;
                        state.username = session.username;
                    }
                } catch (e) {
                    localStorage.removeItem('davosSession');
                }
            }
        }

        // Update UI based on state
        function updateUI() {
            // Update visible logs
            state.visibleLogs = state.logs.public.slice();
            
            if (state.authenticated) {
                state.visibleLogs = state.visibleLogs.concat(state.logs.private);
                elements.loginForm.style.display = 'none';
                elements.adminTools.style.display = 'block';
                elements.securityWarning.style.display = 'none';
            } else {
                elements.loginForm.style.display = 'block';
                elements.adminTools.style.display = 'none';
                elements.securityWarning.style.display = 'block';
            }
            
            // Render logs
            renderLogs();
            
            // Display appropriate content
            if (state.selectedLog && !state.editMode) {
                renderLogDetail(state.selectedLog);
                elements.welcomeMessage.style.display = 'none';
                elements.editForm.style.display = 'none';
            } else if (state.editMode && state.selectedLog) {
                populateEditForm(state.selectedLog);
                elements.welcomeMessage.style.display = 'none';
                elements.editForm.style.display = 'block';
            } else {
                elements.welcomeMessage.style.display = 'block';
                elements.editForm.style.display = 'none';
            }
        }

        // Render log list
        function renderLogs() {
            // Sort logs by date (newest first)
            const sortedLogs = state.visibleLogs.sort((a, b) => {
                return b.date.localeCompare(a.date);
            });
            
            elements.logList.innerHTML = '';
            
            sortedLogs.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = `log-entry ${state.selectedLog && state.selectedLog.id === log.id ? 'selected' : ''}`;
                logElement.dataset.id = log.id;
                
                const typeClass = log.type === 'public' ? 'public-log' : 'private-log';
                const typeText = log.type === 'public' ? 'PUBLIC' : 'CLASSIFIED';
                
                logElement.innerHTML = `
                    <div class="log-meta">
                        <span>${log.date}</span>
                        <span class="${typeClass}">${typeText}</span>
                    </div>
                    <div class="log-title">${log.title}</div>
                    <div class="log-preview">${log.preview}</div>
                `;
                
                logElement.addEventListener('click', () => {
                    state.selectedLog = log;
                    state.editMode = false;
                    updateUI();
                });
                
                elements.logList.appendChild(logElement);
            });
        }

        // Render log detail
        function renderLogDetail(log) {
            const typeClass = log.type === 'public' ? 'public-log' : 'private-log';
            const typeText = log.type === 'public' ? 'PUBLIC' : 'CLASSIFIED';
            
            let html = `
                <h2>${log.title}</h2>
                <div class="log-meta">
                    <span>REF: ${log.date}</span>
                    <span class="${typeClass}">${typeText}</span>
                </div>
                <div>
            `;
            
            // Add image if log has one
            if (log.hasImage && log.imageUrl) {
                html += `
                    <div>
                        <img src="${log.imageUrl}" alt="${log.imageCaption}">
                        <div class="caption">${log.imageCaption}</div>
                    </div>
                `;
            }
            
            // Add personnel section if log has personnel
            if (log.personnel && log.personnel.length > 0) {
                html += `
                    <div class="personnel-section">
                        <div class="personnel-title">MISSION PERSONNEL (${log.personnel.length})</div>
                        <div class="personnel-grid">
                `;
                
                log.personnel.forEach(person => {
                    const statusClass = `status-${person.status.toLowerCase()}`;
                    html += `
                        <div class="personnel-card">
                            ${person.imageUrl ? `<img src="${person.imageUrl}" class="personnel-img" alt="${person.name}">` : ''}
                            <div class="personnel-name">${person.name}</div>
                            <div class="personnel-status ${statusClass}">${person.status}</div>
                            <div class="personnel-details">${person.details}</div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // Add log content
            html += `
                    <div style="white-space: pre-line;">${log.content}</div>
                </div>
            `;

            // Add edit/delete buttons if authenticated
            if (state.authenticated) {
                html += `
                    <div style="margin-top: 20px;">
                        <button id="delete-log-btn" class="delete">DELETE</button>
                        <button id="edit-log-btn">EDIT</button>
                    </div>
                `;
            }
            
            elements.logDetail.innerHTML = html;

            // Add event listeners
            if (state.authenticated) {
                document.getElementById('edit-log-btn').addEventListener('click', () => {
                    state.editMode = true;
                    updateUI();
                });
                
                document.getElementById('delete-log-btn').addEventListener('click', () => {
                    deleteLog(log);
                });
            }
        }

        // Toggle new log image section
        function toggleNewImageSection() {
            elements.newImageSection.style.display = 
                document.getElementById('new-has-image').checked ? 'block' : 'none';
        }

        // Toggle edit image section
        function toggleEditImageSection() {
            elements.editImageSection.style.display = 
                document.getElementById('edit-has-image').checked ? 'block' : 'none';
        }

        // Show new log form
        function showNewLogForm() {
            document.getElementById('new-title').value = '';
            document.getElementById('new-date').value = '';
            document.getElementById('new-preview').value = '';
            document.getElementById('new-type').value = 'public';
            document.getElementById('new-content').value = '';
            document.getElementById('new-has-image').checked = false;
            document.getElementById('new-image-url').value = '';
            document.getElementById('new-image-caption').value = '';
            elements.newImageSection.style.display = 'none';
            elements.newPersonnelList.innerHTML = '';
            elements.newLogForm.style.display = 'block';
        }

        // Hide new log form
        function hideNewLogForm() {
            elements.newLogForm.style.display = 'none';
        }

        // Save new log
        function saveNewLog() {
            const title = document.getElementById('new-title').value;
            const date = document.getElementById('new-date').value;
            const preview = document.getElementById('new-preview').value;
            const type = document.getElementById('new-type').value;
            const content = document.getElementById('new-content').value;
            const hasImage = document.getElementById('new-has-image').checked;
            const imageUrl = document.getElementById('new-image-url').value;
            const imageCaption = document.getElementById('new-image-caption').value;
            const personnel = collectPersonnelData('new-personnel-list');

            // Simple validation
            if (!title || !date || !preview || !content) {
                alert('Please fill out all required fields.');
                return;
            }

            if (hasImage && !imageUrl) {
                alert('Please provide an image URL or uncheck the "Include Image" option.');
                return;
            }

            // Create new log
            const newLog = {
                id: state.nextId++,
                title,
                date,
                preview,
                type,
                content,
                hasImage,
                imageUrl: hasImage ? imageUrl : '',
                imageCaption: hasImage ? imageCaption : '',
                personnel: personnel
            };

            // Add to appropriate array
            if (type === 'public') {
                state.logs.public.push(newLog);
            } else {
                state.logs.private.push(newLog);
            }

            // Save to localStorage
            saveLogs();

            // Hide form and update UI
            hideNewLogForm();
            state.selectedLog = newLog;
            updateUI();
        }

        // Populate edit form
        function populateEditForm(log) {
            document.getElementById('edit-title').value = log.title;
            document.getElementById('edit-date').value = log.date;
            document.getElementById('edit-preview').value = log.preview;
            document.getElementById('edit-type').value = log.type;
            document.getElementById('edit-content').value = log.content;
            document.getElementById('edit-has-image').checked = log.hasImage;
            document.getElementById('edit-image-url').value = log.imageUrl || '';
            document.getElementById('edit-image-caption').value = log.imageCaption || '';
            elements.editImageSection.style.display = log.hasImage ? 'block' : 'none';
            
            // Clear and populate personnel
            elements.editPersonnelList.innerHTML = '';
            if (log.personnel && log.personnel.length > 0) {
                log.personnel.forEach((person, index) => {
                    createPersonnelForm('edit-personnel-list', index, person);
                });
            }
        }

        // Cancel edit
        function cancelEdit() {
            state.editMode = false;
            updateUI();
        }

        // Save edit
        function saveEdit() {
            const title = document.getElementById('edit-title').value;
            const date = document.getElementById('edit-date').value;
            const preview = document.getElementById('edit-preview').value;
            const type = document.getElementById('edit-type').value;
            const content = document.getElementById('edit-content').value;
            const hasImage = document.getElementById('edit-has-image').checked;
            const imageUrl = document.getElementById('edit-image-url').value;
            const imageCaption = document.getElementById('edit-image-caption').value;
            const personnel = collectPersonnelData('edit-personnel-list');

            // Simple validation
            if (!title || !date || !preview || !content) {
                alert('Please fill out all required fields.');
                return;
            }

            if (hasImage && !imageUrl) {
                alert('Please provide an image URL or uncheck the "Include Image" option.');
                return;
            }

            // Find the log to update
            const logToUpdate = state.selectedLog;
            const oldType = logToUpdate.type;

            // Update log
            logToUpdate.title = title;
            logToUpdate.date = date;
            logToUpdate.preview = preview;
            logToUpdate.type = type;
            logToUpdate.content = content;
            logToUpdate.hasImage = hasImage;
            logToUpdate.imageUrl = hasImage ? imageUrl : '';
            logToUpdate.imageCaption = hasImage ? imageCaption : '';
            logToUpdate.personnel = personnel;

            // If type changed, move the log to the appropriate array
            if (oldType !== type) {
                // Remove from old array
                if (oldType === 'public') {
                    state.logs.public = state.logs.public.filter(log => log.id !== logToUpdate.id);
                } else {
                    state.logs.private = state.logs.private.filter(log => log.id !== logToUpdate.id);
                }

                // Add to new array
                if (type === 'public') {
                    state.logs.public.push(logToUpdate);
                } else {
                    state.logs.private.push(logToUpdate);
                }
            }

            // Save to localStorage
            saveLogs();

            // Exit edit mode and update UI
            state.editMode = false;
            updateUI();
        }

        // Delete log
        function deleteLog(log) {
            if (confirm('Are you sure you want to delete this log? This action cannot be undone.')) {
                // Remove from appropriate array
                if (log.type === 'public') {
                    state.logs.public = state.logs.public.filter(l => l.id !== log.id);
                } else {
                    state.logs.private = state.logs.private.filter(l => l.id !== log.id);
                }

                // Save to localStorage
                saveLogs();

                // Reset selected log and update UI
                state.selectedLog = null;
                updateUI();
            }
        }

        // Save logs to localStorage
        function saveLogs() {
            localStorage.setItem('davosLogs', JSON.stringify(state.logs));
        }

        // Export logs
        function exportLogs() {
            const logsJson = JSON.stringify(state.logs, null, 2);
            const blob = new Blob([logsJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'davos_logs_export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Import logs
        function importLogs(event) {
            const file = event.target.files[0];
            
            if (!file) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedLogs = JSON.parse(e.target.result);
                    
                    // Validate structure
                    if (!importedLogs.public || !importedLogs.private) {
                        throw new Error('Invalid log format. The file must contain "public" and "private" arrays.');
                    }
                    
                    // Find highest ID to continue from
                    let highestId = 0;
                    [...importedLogs.public, ...importedLogs.private].forEach(log => {
                        if (log.id > highestId) {
                            highestId = log.id;
                        }
                    });
                    
                    // Update state
                    state.logs = importedLogs;
                    state.nextId = highestId + 1;
                    
                    // Save to localStorage
                    saveLogs();
                    
                    // Update UI
                    state.selectedLog = null;
                    updateUI();
                    
                    alert('Logs imported successfully.');
                } catch (error) {
                    alert('Error importing logs: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset the file input
            event.target.value = '';
        }
    </script>
</body>
</html>
